<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<section class="vh-100">
  <div class="container py-5 h-100">
    <div class="row d-flex justify-content-center align-items-center h-100">
      <div class="col">
        <div class="mb-5" id="list1" style="border-radius: .75rem; background-color:#b3c4cda1;">
          <div class="card-body py-4 px-4 px-md-5">
            <p class="h1 text-center mt-3 mb-4 pb-3 text-info">
              <i class="fas fa-check-square me-1"></i>
              <u>My Todo-s</u>
            </p>
            <div class="pb-2">
              <div class="card">
                <div class="card-body">
                  <div class="d-flex flex-row align-items-center">
                    <input type="text" class="form-control form-control-lg" id="exampleFormControlInput1"
                      placeholder="Search...">
                    <div>
                      <button type="button" class="ms-2 btn btn-info" data-bs-toggle="modal"
                        data-bs-target="#exampleModal">Add</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <hr class="my-4">
            <div class="d-flex justify-content-end align-items-center mb-4 pt-2 pb-3">
              <p class="small mb-0 me-2 text-muted">Filter</p>
              <select class="select">
                <option value="1">All</option>
                <option value="2">Completed</option>
                <option value="3">Active</option>
                <option value="4">Has due date</option>
              </select>
              <p class="small mb-0 ms-4 me-2 text-muted">Sort</p>
              <select class="select">
                <option value="1">Added date</option>
                <option value="2">Due date</option>
              </select>
              <a href="#!" style="color: #23af89;" data-mdb-toggle="tooltip" title="Ascending"><i
                  class="fas fa-sort-amount-down-alt ms-2"></i></a>
            </div>
            <div class="tab-content bg-transparent">
              <div id="note-full-container" class="note-has-grid row justify-content-center">
                <% if (notes.length && Array.isArray(notes)) { %>
                  <% notes.forEach(function(note) { %>
                    <div class="col-md-9 single-note-item all-category mb-3">
                      <div class=" bg-white rounded-1 p-4 row">
                        <div class="col-md-4">
                          <div style="height: 200px" class="mb-3">
                            <img class="note-image-content image-container" src="<%= note.image %>" width="200px"
                              height="100%" name="img" style="object-fit:cover  ;" />
                          </div>
                        </div>
                        <div class="col-md-8">
                          <h4 class="note-title text-truncate w-75 mb-3" data-noteheading="Book a Ticket for Movie">
                            <%= note.name %>
                          </h4>
                          <p class="note-date font-12 text-muted">
                            <%= moment(note.created_at) %>
                          </p>
                          <div class="note-content">
                            <p class="note-inner-content text-muted" data-textquill="<%=note.description %>">
                              <%- note.description %>
                            </p>
                          </div>
                        </div>

                        <div class="d-flex align-items-center justify-content-end">

                          <button class="mr-1 edit-note" data-bs-toggle="modal" data-bs-target="#update-notes-modal"
                            data-noteid="<%= note.id %>"><i class="fa fa-edit"></i></button>
                          <button class="mr-1 delete-note" data-notedeleteid="<%= note.id %>"
                            data-bs-target="#delete-notes-modal" data-bs-toggle="modal"><i
                              class="fa fa-trash remove-note"></i></button>

                        </div>
                      </div>
                    </div>
                    <% }) %>
                      <% } else { %>
                        <p class="text-center">No notes available.</p>
                        <% } %>
              </div>
            </div>
          </div>
        </div>
      </div>
</section>
<!-- modal add -->
<section>
  <form method="post" action="/create-note" class="modal fade" id="exampleModal" tabindex="-1"
    aria-labelledby="exampleModalLabel" aria-hidden="true" style="display: none;">

    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content border-0">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title text-white">Add Note</h5>
          <button type="button" class="close text-white" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="notes-box">
            <div class="notes-content">
              <form id="addnotesmodalTitle">
                <div class="row">

                  <div class="col-md-12 mb-3">
                    <div class="note-title">
                      <label>Note Title</label>
                      <input type="text" class="form-control" required placeholder="Title" name='name' />
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="note-description">
                      <label>Note Description</label>
                      <textarea class="editor" name="description" hidden></textarea>
                      <div id="editor-container" style="height:200px;"></div>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <label>Image</label>
                    <div class="imgBox">
                      <label class="imgWrap" for="chooseImg">
                        <div class="imgElement" style="width: 100%"></div>
                        <input type="file" id="chooseImg"
                          onchange="uploadImage('/upload-img', '#exampleModal .modal-dialog', 'img', this)" />
                        <input type="hidden" name="img" class="imgUrl" />
                      </label>
                    </div>
                  </div>

                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <!-- <button class="btn btn-danger" data-bs-dismiss="modal">Cancel</button> -->
          <button type="submit" id="btn-n-add" class="btn btn-info">Add</button>
        </div>
      </div>
    </div>
  </form>
</section>
<!-- modal update -->
<section>
  <form method="post" class="modal fade" id="update-notes-modal" tabindex="-1" aria-labelledby="updateleModalLabel"
    aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content border-0">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title text-white">Update Note</h5>
          <button type="button" class="close text-white" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="notes-box">
            <div class="notes-content">
              <div>
                <div class="row ">
                  <div class="col-md-12 mb-3 ">
                    <div>
                      <label>Note Title</label>
                      <input type="text" id="note-has-title" class="form-control" required placeholder="Tiêu đề"
                        name='nameNote' />
                    </div>
                  </div>

                  <div class="col-md-12 ">
                    <div class="note-description">
                      <label>Note Description</label>
                      <div id="editor-container-update" style="height: 300px;"></div>
                      <textarea id="note-has-description" class="editor-update" name="descriptionNote" hidden
                        required></textarea>

                    </div>
                  </div>
                </div>
                <div class="col-md-12">
                  <label>Image</label>
                  <div class="imgBox">
                    <label class="imgWrap" for="chooseImg">
                      <div class="imgElement" style="width: 100%"></div>
                      <input id="chooseImg" type="file"
                        onchange="uploadImage('/upload-img', '#update-notes-modal .modal-dialog', 'img', this)" />
                      <input type="hidden" name="img" class="imgUrl" />
                      <div class="d-flex justify-content-between">
                        <img id=note-has-image style="object-fit: cover;" width="200px" height="200px" class="mt-3" />
                      </div>
                    </label>
                  </div>
                </div>
                <input type="hidden" id="update-note-id" name="noteId">
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-info">Update</button>
        </div>
      </div>
    </div>
  </form>
</section>
<!-- modal delete -->
<section>
  <form method="post" class="modal fade" id="delete-notes-modal" tabindex="-1" aria-labelledby="deleteModalLabel"
    aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content border-0">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title text-white">Delete Note</h5>
          <button type="button" class="close text-white" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="notes-box">
            <div class="notes-content">
              <div>
                <div>Want to delete a note?</div>
                <input type="hidden" id="delete-note-id" name="noteDeleteId">

              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-info">Delete</button>
        </div>
      </div>
    </div>
  </form>
</section>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const editButtons = document.querySelectorAll('.edit-note');
    const deleteButtons = document.querySelectorAll('.delete-note');

    const deleteForm = document.querySelector('#delete-notes-modal');
    const updateForm = document.querySelector('#update-notes-modal');
    const imgBox = document.querySelector('.imgBox');

    const noteInnerContent = document.querySelector('.note-inner-content')
    const textQuill = noteInnerContent.dataset.textquill;

    editButtons.forEach(button => {
      button.addEventListener('click', function () {
        const noteId = this.getAttribute('data-noteid');

        const formAction = `/update-note/${noteId}`;
        updateForm.setAttribute('action', formAction);
        const noteTitle = this.closest('.single-note-item').querySelector('.note-title').innerText;
        const noteImage = this.closest('.single-note-item').querySelector('.note-image-content').getAttribute('src');

        const updateNoteIdField = document.querySelector('#update-note-id');
        const noteTitleField = document.querySelector('#note-has-title');
        const noteImageField = document.querySelector('#note-has-image');
  
        updateNoteIdField.value = noteId;
        noteTitleField.value = noteTitle;
        noteImageField.src = noteImage;
     

      });
    });
    deleteButtons.forEach(button => {
      button.addEventListener('click', function () {
        const noteId = this.getAttribute('data-notedeleteid');
        const formAction = `/delete-note/${noteId}`;
        deleteForm.setAttribute('action', formAction);

        const deleteNoteIdField = document.querySelector('#delete-note-id');
        deleteNoteIdField.value = noteId;
        // alert(noteId)
      });
    })
  });
</script>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
  var quill = new Quill('#editor-container', {
    theme: 'snow'
  });
  var descriptionTextarea = document.querySelector('.editor');
  quill.on('text-change', function () {
    var content = quill.getContents();
    descriptionTextarea.value = JSON.stringify(content);
  });
</script>
<script>
  const noteInnerContent1 = document.querySelector('.note-inner-content');
  const textQuill1 = noteInnerContent1.dataset.textquill;

  var quillUpdate = new Quill('#editor-container-update', {
    theme: 'snow'
  });
  var descriptionUploadTextarea = document.querySelector('.editor-update');
  var deltaObject = quillUpdate.clipboard.convert(textQuill1);
  quillUpdate.setContents(deltaObject);
  descriptionUploadTextarea.value = JSON.stringify(deltaObject); 

  quillUpdate.on('text-change', function () {
    var content = quillUpdate.getContents();
    descriptionUploadTextarea.value = JSON.stringify(content);
  });
</script>